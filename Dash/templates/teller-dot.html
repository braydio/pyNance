<!DOCTYPE html>
<html>
    <body>
        <header>
          <div>
            <h1>Accounts</h1>
            <h3>dot Brayden.com</h3>
          </div>
          <nav class="menu">
            <button onclick="window.location.href='/'">Dashboard</button>
            <button onclick="window.location.href='/teller-dot'">Teller.IO</button>
            <button onclick="window.location.href='/accounts'">Accounts</button>
            <button onclick="window.location.href='/transactions'">Transactions</button>
            <button onclick="window.location.href='/settings'">Settings</button>
          </nav>
        </header>
    <body>
    <!-- Teller Connect Button -->
    <button id="teller-connect">Connect to your bank</button>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Teller Connect setup
            var tellerConnect = TellerConnect.setup({
                applicationId: "{{ application_id }}", // Passed from Flask
                products: ["transactions", "balance"],
                onInit: function () {
                    console.log("Teller Connect initialized");
                },
                onSuccess: function (enrollment) {
                    console.log("Enrollment successful", enrollment);
                    // Send the public_token to the backend
                    fetch("/exchange_public_token", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ public_token: enrollment.accessToken })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === "success") {
                            console.log("Access token saved:", data.access_token);
                        } else {
                            console.error("Error saving access token:", data.error);
                        }
                    })
                    .catch(error => console.error("Error:", error));
                },
                onExit: function () {
                    console.log("User exited Teller Connect");
                }
            });

            // Add click event to the button
            document.getElementById("teller-connect").addEventListener("click", function () {
                tellerConnect.open();
            });
        });
    </script>
</body>
</html>
